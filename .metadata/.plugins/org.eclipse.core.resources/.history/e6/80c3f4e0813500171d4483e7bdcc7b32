package controllers;

import java.util.Locale;
import java.util.ResourceBundle;

import javafx.fxml.FXML;
import javafx.scene.control.Label;
import javafx.scene.layout.AnchorPane;
import lang.Language;
import model.Movie;

public class MovieThumbnailController {
	
	public static final String TEXTS_PATH = "language/texts";
	public static final String RATING = "rating";
	

    @FXML
    private Label movieTitleLabel;

    @FXML
    private AnchorPane backgroundPane;

    @FXML
    private Label movieRatingLabel;

    @FXML
    private Label movieGenreLabel;
    
    @FXML
    private Label textRatingLabel;
    
    
    private Movie movie;
    
    
    
    @FXML
    void initialize(){
    	// Set texts from properties
    	Locale lang = Language.getInstance().getLanguage();
    	ResourceBundle bundle = ResourceBundle.getBundle(TEXTS_PATH, lang);
    	textRatingLabel.setText(bundle.getString(RATING));
    	
    	// Initialize Double click handler and action
    	setOnMouseClicked(event -> {
            if (event.getClickCount() == 2 && (!row.isEmpty())) {
                try {

                    //
                    FXMLLoader loader = new FXMLLoader();
                    loader.setLocation(getClass().getClassLoader().getResource("edit_movie.fxml"));
                    AnchorPane root = null;
                    root = (AnchorPane) loader.load();
                    EditMovieController emc = loader.getController();
                    emc.setPrimaryStage(primaryStage);
                    emc.setPreviousScene(this.scene);

                    // Send DB connection
                    emc.setDbConnector(dbConnector);
                    emc.init();

                    emc.initValues(row.getItem().getId());
                    primaryStage.setTitle("Filmový portál - Uprav film");
                    primaryStage.setScene(new Scene(root));

                } catch (IOException e) {
                    e.printStackTrace();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
        });
    }


    public void initValues() {
        movieTitleLabel.setText(movie.getTitle());
        movieGenreLabel.setText(movie.getGenresAsString());
        movieRatingLabel.setText(movie.getRating().toString());
    }
    
    public void setMovie(Movie movie){
    	this.movie = movie;
    }

}
