package controllers;

import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.layout.AnchorPane;
import javafx.scene.layout.FlowPane;
import javafx.stage.Stage;

import java.io.IOException;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;
import java.util.Locale;
import java.util.ResourceBundle;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.naming.Context;

import remotes.MovieManagerRemote;
import context.ContextLoader;
import lang.Language;


public class HomeController {
	
	public static Logger LOG = Logger.getLogger(HomeController.class.getName());
	
	public static final String TEXTS_PATH = "language/texts";
	
	public static final String APP_NAME = "applicationName";
	public static final String NEW_MOVIES = "newFilms";
	public static final String FAV_LIST = "favouriteList";
	public static final String SCAN_QR = "scanQR";
	
	public static final String MOVIE_MANAGER = "ejb:AATM/Logic/MovieManager!remotes.MovieManagerRemote";
	public static final String USER_MANAGER = "ejb:AATM/Logic/UserManager!remotes.UserManagerRemote";
	
	

    @FXML
    private FlowPane containerFlowPane;

    @FXML
    private Label userNameLabel;

    @FXML
    private Label appTitleLabel;

    @FXML
    private Label newFilmsLabel;

    @FXML
    private Button favouriteListButton;

    @FXML
    private Button scanQRButton;


    // Switching Scenes
    private Stage mainStage;
    private Scene previousScene;


    @FXML
    void initialize() {
    	
    	
    	// Set texts from properties
    	Locale lang = Language.getInstance().getLanguage();
    	ResourceBundle bundle = ResourceBundle.getBundle(TEXTS_PATH, lang);

    	// Intialize text fields
    	appTitleLabel.setText(bundle.getString(APP_NAME));
    	newFilmsLabel.setText(bundle.getString(NEW_MOVIES));
    	favouriteListButton.setText(bundle.getString(FAV_LIST));
    	scanQRButton.setText(bundle.getString(SCAN_QR));
    }

    void displayMovies() throws IOException {

    	Context ctx = ContextLoader.createRemoteEjbContext();
    	MovieManagerRemote movieManager = ctx.lookup(MOVIE_MANAGER);


        for (String s : titles) {
            FXMLLoader loader = new FXMLLoader();
            loader.setLocation(getClass().getClassLoader().getResource("fxml/movie_thumbnail.fxml"));
            AnchorPane movie = loader.load();
            MovieThumbnailController mtc = loader.getController();
            mtc.initValues(s, "Comedy, Drama", 7.6);
            containerFlowPane.getChildren().add(movie);
        }
    }


    @FXML
    void showFavouriteList(ActionEvent event) {

    }

    @FXML
    void scanQRcode(ActionEvent event) {

    }

}
